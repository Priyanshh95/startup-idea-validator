{% extends "base.html" %}

{% block title %}Validate Idea - Startup Idea Validator{% endblock %}

{% block content %}
<section class="page-header">
    <div class="container">
        <h1>Validate Your Startup Idea</h1>
        <p>Get AI-powered insights and community feedback on your startup concept</p>
    </div>
</section>

<section class="validation-section">
    <div class="container">
        <div class="validation-form-container">
            <form id="ideaForm" class="idea-form">
                <div class="form-group">
                    <label for="ideaInput">Describe Your Startup Idea</label>
                    <textarea 
                        id="ideaInput" 
                        name="idea" 
                        placeholder="e.g., A mobile app that connects dog owners with local dog walkers using AI matching algorithms..."
                        required
                    ></textarea>
                </div>
                <button type="submit" class="btn btn-primary btn-large" id="validateBtn">
                    <i class="fas fa-magic"></i>
                    Validate My Idea
                </button>
            </form>
        </div>

        <div id="loadingSpinner" class="loading-spinner" style="display: none;">
            <div class="spinner"></div>
            <p>Analyzing your idea with AI...</p>
        </div>

        <div id="validationResults" class="validation-results" style="display: none;">
            <div class="results-header">
                <h2>Validation Report</h2>
                <div class="viability-score">
                    <span>Viability Score:</span>
                    <div class="score-circle">
                        <span id="scoreValue">0</span>%
                    </div>
                </div>
            </div>

            <div class="results-grid">
                <div class="result-card">
                    <h3><i class="fas fa-exclamation-triangle"></i> Problem Statement</h3>
                    <p id="problemText"></p>
                </div>
                <div class="result-card">
                    <h3><i class="fas fa-lightbulb"></i> Solution Overview</h3>
                    <p id="solutionText"></p>
                </div>
                <div class="result-card">
                    <h3><i class="fas fa-users"></i> Target Audience</h3>
                    <p id="audienceText"></p>
                </div>
                <div class="result-card">
                    <h3><i class="fas fa-chart-bar"></i> Market Demand</h3>
                    <div class="demand-indicator">
                        <span id="demandLevel"></span>
                        <div class="demand-bar">
                            <div id="demandProgress"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="competitors-section">
                <h3><i class="fas fa-trophy"></i> Key Competitors</h3>
                <div id="competitorsList"></div>
            </div>

            <div class="recommendations-section">
                <h3><i class="fas fa-star"></i> AI Recommendations</h3>
                <ul id="recommendationsList"></ul>
            </div>

            <div class="feedback-section">
                <h3><i class="fas fa-comments"></i> Community Feedback</h3>
                <form id="feedbackForm" class="feedback-form">
                    <textarea 
                        id="feedbackInput" 
                        placeholder="Share your thoughts on this startup idea..."
                        required
                    ></textarea>
                    <button type="submit" class="btn btn-secondary">
                        Submit Feedback
                    </button>
                </form>
                <div id="feedbackList" class="feedback-list">
                    <!-- Feedback items will be loaded here -->
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const ideaForm = document.getElementById('ideaForm');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const validationResults = document.getElementById('validationResults');
    const feedbackForm = document.getElementById('feedbackForm');

    ideaForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const ideaInput = document.getElementById('ideaInput').value;
        
        if (!ideaInput.trim()) {
            alert('Please enter your startup idea');
            return;
        }

        validateIdea(ideaInput);
    });

    feedbackForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const feedbackInput = document.getElementById('feedbackInput').value;
        
        if (!feedbackInput.trim()) {
            alert('Please enter your feedback');
            return;
        }

        submitFeedback(feedbackInput);
    });

    function validateIdea(idea) {
        loadingSpinner.style.display = 'block';
        validationResults.style.display = 'none';

        fetch('/api/validate-idea', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ idea: idea })
        })
        .then(response => response.json())
        .then(data => {
            displayResults(data);
            loadingSpinner.style.display = 'none';
            validationResults.style.display = 'block';
        })
        .catch(error => {
            console.error('Error:', error);
            loadingSpinner.style.display = 'none';
            alert('Error validating idea. Please try again.');
        });
    }

    function displayResults(data) {
        document.getElementById('scoreValue').textContent = data.viability_score;
        document.getElementById('problemText').textContent = data.problem;
        document.getElementById('solutionText').textContent = data.solution;
        document.getElementById('audienceText').textContent = data.target_audience;
        
        const demandLevel = document.getElementById('demandLevel');
        const demandProgress = document.getElementById('demandProgress');
        demandLevel.textContent = data.market_demand;
        
        const demandPercentage = data.market_demand === 'High' ? 80 : 
                                data.market_demand === 'Medium' ? 50 : 20;
        demandProgress.style.width = demandPercentage + '%';
        demandProgress.className = `demand-progress ${data.market_demand.toLowerCase()}`;

        const competitorsList = document.getElementById('competitorsList');
        competitorsList.innerHTML = data.competitors.map(comp => 
            `<span class="competitor-tag">${comp}</span>`
        ).join('');

        const recommendationsList = document.getElementById('recommendationsList');
        recommendationsList.innerHTML = data.recommendations.map(rec => 
            `<li>${rec}</li>`
        ).join('');
    }

    function submitFeedback(feedback) {
        fetch('/api/submit-feedback', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ feedback: feedback })
        })
        .then(response => response.json())
        .then(data => {
            alert('Feedback submitted successfully!');
            document.getElementById('feedbackInput').value = '';
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error submitting feedback. Please try again.');
        });
    }
});
</script>
{% endblock %}
