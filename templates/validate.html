{% extends "base.html" %}

{% block title %}Validate Idea - Startup Idea Validator{% endblock %}

{% block content %}
<section class="page-header">
    <div class="container">
        <h1>Validate Your Startup Idea</h1>
        <p>Get AI-powered analysis and community feedback on your startup concept.</p>
    </div>
</section>

<section class="validation">
    <div class="container">
        <div class="validation-form">
            <form id="ideaForm">
                <div class="form-group">
                    <label for="ideaInput">Describe Your Startup Idea</label>
                    <textarea 
                        id="ideaInput" 
                        name="idea" 
                        placeholder="Example: A mobile app that connects dog owners with local dog walkers using AI matching algorithms. The app would include GPS tracking, payment processing, and review systems..."
                        required
                    ></textarea>
                    <small>Be as detailed as possible for better analysis results.</small>
                </div>
                <button type="submit" class="btn btn-primary" id="validateBtn">
                    <i class="fas fa-magic"></i>
                    Analyze My Idea
                </button>
            </form>
        </div>

        <div id="loadingState" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>Analyzing your idea with AI...</p>
        </div>

        <div id="results" class="results" style="display: none;">
            <div class="results-header">
                <h2>Validation Report</h2>
                <div class="score">
                    <span class="score-label">Viability Score</span>
                    <span class="score-value" id="scoreValue">0</span>
                    <span class="score-max">/100</span>
                </div>
            </div>

            <div class="results-content">
                <div class="result-section">
                    <h3><i class="fas fa-exclamation-triangle"></i> Problem Statement</h3>
                    <p id="problemText"></p>
                </div>

                <div class="result-section">
                    <h3><i class="fas fa-lightbulb"></i> Solution Overview</h3>
                    <p id="solutionText"></p>
                </div>

                <div class="result-section">
                    <h3><i class="fas fa-users"></i> Target Audience</h3>
                    <p id="audienceText"></p>
                </div>

                <div class="result-section">
                    <h3><i class="fas fa-chart-bar"></i> Market Demand</h3>
                    <div class="demand-level">
                        <span id="demandLevel"></span>
                        <div class="demand-bar">
                            <div id="demandProgress"></div>
                        </div>
                    </div>
                </div>

                <div class="result-section">
                    <h3><i class="fas fa-trophy"></i> Key Competitors</h3>
                    <div id="competitorsList"></div>
                </div>

                <div class="result-section">
                    <h3><i class="fas fa-star"></i> Recommendations</h3>
                    <ul id="recommendationsList"></ul>
                </div>

                <div class="feedback-section">
                    <h3><i class="fas fa-comments"></i> Share for Community Feedback</h3>
                    <form id="feedbackForm">
                        <textarea 
                            id="feedbackInput" 
                            placeholder="Ask the community for specific feedback on your idea..."
                            required
                        ></textarea>
                        <button type="submit" class="btn btn-outline">
                            Share with Community
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const ideaForm = document.getElementById('ideaForm');
    const loadingState = document.getElementById('loadingState');
    const results = document.getElementById('results');
    const feedbackForm = document.getElementById('feedbackForm');

    ideaForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const ideaInput = document.getElementById('ideaInput').value;
        
        if (!ideaInput.trim()) {
            alert('Please enter your startup idea');
            return;
        }

        validateIdea(ideaInput);
    });

    feedbackForm.addEventListener('submit', function(e) {
        e.preventDefault();
        const feedbackInput = document.getElementById('feedbackInput').value;
        
        if (!feedbackInput.trim()) {
            alert('Please enter your feedback request');
            return;
        }

        submitFeedback(feedbackInput);
    });

    function validateIdea(idea) {
        loadingState.style.display = 'block';
        results.style.display = 'none';

        fetch('/api/validate-idea', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ idea: idea })
        })
        .then(response => response.json())
        .then(data => {
            displayResults(data);
            loadingState.style.display = 'none';
            results.style.display = 'block';
        })
        .catch(error => {
            console.error('Error:', error);
            loadingState.style.display = 'none';
            alert('Error validating idea. Please try again.');
        });
    }

    function displayResults(data) {
        document.getElementById('scoreValue').textContent = data.viability_score;
        document.getElementById('problemText').textContent = data.problem;
        document.getElementById('solutionText').textContent = data.solution;
        document.getElementById('audienceText').textContent = data.target_audience;
        
        const demandLevel = document.getElementById('demandLevel');
        const demandProgress = document.getElementById('demandProgress');
        demandLevel.textContent = data.market_demand;
        
        const demandPercentage = data.market_demand === 'High' ? 80 : 
                                data.market_demand === 'Medium' ? 50 : 20;
        demandProgress.style.width = demandPercentage + '%';
        demandProgress.className = `demand-fill ${data.market_demand.toLowerCase()}`;

        const competitorsList = document.getElementById('competitorsList');
        competitorsList.innerHTML = data.competitors.map(comp => 
            `<span class="competitor">${comp}</span>`
        ).join('');

        const recommendationsList = document.getElementById('recommendationsList');
        recommendationsList.innerHTML = data.recommendations.map(rec => 
            `<li>${rec}</li>`
        ).join('');
    }

    function submitFeedback(feedback) {
        fetch('/api/submit-feedback', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ feedback: feedback })
        })
        .then(response => response.json())
        .then(data => {
            alert('Shared with community successfully!');
            document.getElementById('feedbackInput').value = '';
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error sharing feedback. Please try again.');
        });
    }
});
</script>
{% endblock %}
